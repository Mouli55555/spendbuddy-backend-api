name: Keep Render Backend Awake

on:
  schedule:
    - cron: "*/5 * * * *"
  workflow_dispatch:

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Install jq
        run: sudo apt-get install -y jq

      - name: Sign in and fetch JWT
        id: auth
        run: |
          RESPONSE=$(curl -s -X POST https://spendbuddy-backend-api.onrender.com/api/auth/signin \
            -H "Content-Type: application/json" \
            -d '{"username":"test","password":"ben11555"}')

          TOKEN=$(echo $RESPONSE | jq -r '.accessToken')
          echo "jwt_token=$TOKEN" >> $GITHUB_OUTPUT

      - name: Ping protected endpoint
        run: |
          curl -s -o /dev/null \
            -H "Authorization: Bearer ${{ steps.auth.outputs.jwt_token }}" \
            https://spendbuddy-backend-api.onrender.com/api/expenses || true
